<odoo>

    <template id="portal_my_home" inherit_id="portal.portal_my_home"
        priority="100" name="Grant Funds &amp; Proposals" customize_show="True">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="before">
            <t t-set="portal_service_category_enable" t-value="True"/>
        </xpath>
        <div id="portal_service_category" position="inside">
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/grant_portal/static/src/img/proposal.svg'"/>
                <t t-set="title">Grant Proposals</t>
                <t t-set="url" t-value="'/my/proposals'"/>
                <t t-set="text">Track the proposals you submitted</t>
                <t t-set="placeholder_count" t-value="'grant_proposals_count'"/>
            </t>
            <t t-call="portal.portal_docs_entry">
                <t t-set="icon" t-value="'/grant_portal/static/src/img/fund.svg'"/>
                <t t-set="title">Grant Funds</t>
                <t t-set="url" t-value="'/my/funds'"/>
                <t t-set="text">Manage the funds you receive</t>
                <t t-set="placeholder_count" t-value="'grant_funds_count'"/>
            </t>
        </div>
    </template>

    <template id="my_grant_proposals" name="My Grant Proposals">
      <t t-call="portal.portal_layout">
        <t t-if="proposals" t-call="portal.portal_table">
          <thead>
            <tr>
              <th>Title</th>
              <th>Call</th>
              <th>State</th>
            </tr>
          </thead>
          <tbody>
            <tr t-foreach="proposals" t-as="doc">
              <td>
                <a t-attf-href="/my/proposals/{{doc.id}}">
                  <span t-field="doc.name"/>
                </a>
              </td>
              <td>
                <span t-field="doc.call_id.name"/>
              </td>
              <td>
                <span t-field="doc.state" t-attf-class="badge #{'text-bg-success' if doc.state in ('done') else 'text-bg-danger' if doc.state in ('close') else 'text-bg-info'} fw-normal o_text_overflow"/>
              </td>
            </tr>
          </tbody>
        </t>
        <t t-else="">
            <div class="alert alert-warning" role="alert">
              You don't have any grant proposals.
            </div>
        </t>
      </t>
    </template>
    <template id="my_grant_funds" name="My Grant Funds">
      <t t-call="portal.portal_layout">
        <t t-if="funds" t-call="portal.portal_table">
          <thead>
            <tr>
              <th>Title</th>
              <th>State</th>
            </tr>
          </thead>
          <tbody>
            <tr t-foreach="funds" t-as="doc">
              <td>
                <a t-attf-href="/my/funds/{{doc.id}}">
                  <span t-field="doc.name"/>
                </a>
              </td>
              <td>
                <span t-field="doc.state" t-attf-class="badge #{'text-bg-success' if doc.state in ('close', 'open') else 'text-bg-warning' if doc.state in ('draft', 'done') else 'text-bg-info'} fw-normal o_text_overflow"/>
              </td>
            </tr>
          </tbody>
        </t>
        <t t-else="">
            <div class="alert alert-warning" role="alert">
              You don't have any grant funds.
            </div>
        </t>
      </t>
    </template>
    
<template id="proposal" name="Proposal" inherit_id="portal.portal_sidebar" primary="True">
      <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
<!--           <t t-set="o_portal_fullwidth_alert" groups="grant.group_grant_user">
              <t t-call="portal.portal_back_in_edit_mode">
                  <t t-set="backend_url" t-value="'/web#model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (grant._name, proposal.id, proposal.env.ref('purchase.purchase_rfq').id)"/>
              </t>
          </t> -->

          <div class="row mt16 o_portal_proposal_sidebar">
              <!-- Sidebar -->
              <t t-call="portal.portal_record_sidebar">
                  <t t-set="classes" t-value="'col-lg-auto d-print-none'"/>

                  <t t-set="title">
                      <h2 class="mb-0"><b t-field="doc.code_proposal" data-id="code_proposal"/> </h2>
                  </t>
                  <t t-set="entries">
                      <ul class="list-group list-group-flush flex-wrap flex-row flex-lg-column">
                          <li class="list-group-item flex-grow-1">
<!--                               <div class="o_download_pdf btn-toolbar flex-sm-nowrap">
                                  <div class="btn-group flex-grow-1 mr-1 mb-1">
                                      <a class="btn btn-secondary btn-block o_download_btn" t-att-href="doc.get_portal_url(report_type='pdf', download=True)" title="Download"><i class="fa fa-download"/> Download</a>
                                  </div>
                                  <div class="btn-group flex-grow-1 mb-1">
                                      <a class="btn btn-secondary btn-block o_print_btn o_portal_proposal_print" t-att-href="doc.get_portal_url(report_type='pdf')" id="print_invoice_report" title="Print" target="_blank"><i class="fa fa-print"/> Print</a>
                                  </div>
                              </div> -->
                          </li>

                          <li class="navspy list-group-item pl-0 flex-grow-1" t-ignore="true" role="complementary">
                              <ul class="nav flex-column bs-sidenav"></ul>
                          </li>

                          <li t-if="doc.user_id" class="list-group-item flex-grow-1">
                              <div class="small mb-1"><strong class="text-muted">Grant officer</strong></div>
                              <div class="row flex-nowrap">
                                  <div class="col flex-grow-0 pr-2">
                                      <img class="rounded-circle mr4 float-left o_portal_contact_img" t-att-src="image_data_uri(doc.user_id.avatar_1024)" alt="Contact"/>
                                  </div>
                                  <div class="col pl-0" style="min-width: 150px">
                                      <span t-field="doc.user_id" t-options='{"widget": "contact", "fields": ["name", "phone"], "no_marker": True}'/>
                                      <a href="#discussion" class="small"><i class="fa fa-comment"></i> Send message</a>
                                  </div>
                              </div>
                          </li>
                      </ul>
                  </t>
              </t>

              <!-- Page content -->
              <div id="proposal_content" class="col-12 col-lg justify-content-end">

                  <!-- status messages -->
                  <div t-if="doc.state == 'cancel'" class="alert alert-danger alert-dismissable d-print-none" role="alert">
                      <strong>This proposal has been canceled.</strong>
                  </div>

                  <!-- main content -->
                  <div t-attf-class="card #{'pb-5' if report_type == 'html' else ''}" id="portal_proposal_content">
                      <div t-call="grant_portal.grant_proposal_portal_content"/>
                  </div>

                  <!-- chatter -->
                  <div id="proposal_communication" class="mt-4">
                      <h2>History</h2>
                      <t t-call="portal.message_thread">
                          <t t-set="object" t-value="doc"/>
                          <t t-if="doc.state=='done'" t-set="disable_composer" t-value="1"/>
                      </t>
                  </div>
              </div><!-- // #quote_content -->
          </div>
      </xpath>
  </template>

  <template id="fund" name="Fund" inherit_id="portal.portal_sidebar" primary="True">
      <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
<!--           <t t-set="o_portal_fullwidth_alert" groups="grant.group_grant_user">
              <t t-call="portal.portal_back_in_edit_mode">
                  <t t-set="backend_url" t-value="'/web#model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (grant._name, proposal.id, proposal.env.ref('purchase.purchase_rfq').id)"/>
              </t>
          </t> -->
            <!-- Sidebar -->
            <div class="row o_project_portal_sidebar">
                <t t-call="portal.portal_record_sidebar">
                    <t t-set="classes" t-value="'col-lg-3 col-xl-4 d-print-none'"/>
                    <t t-set="title">
                        <h2 t-field="doc.name" />
                    </t>
                    <t t-set="entries">
                        <div class="d-flex flex-wrap flex-column gap-4">
                            <div id="fund-nav" class="d-flex align-items-center flex-grow-1 p-0" t-ignore="true" role="complementary">
                                <ul class="nav flex-column">
                                    <li class="nav-item" id="nav-header">
                                        <a class="nav-link p-0" href="#card_header">
                                            Fund
                                        </a>
                                    </li>
                                    <li class="nav-item" id="nav-chat">
                                        <a class="nav-link p-0" href="#fund_chat">
                                            History
                                        </a>
                                    </li>
                                </ul>
                            </div>

                            <div class="d-flex flex-column gap-4">
                              <h6 class="flex-basis-100"><small class="text-muted">Grant officer</small></h6>
                              <div class="o_portal_contact_details d-flex flex-column gap-2">
                                            <div class="d-flex justify-content-start align-items-center gap-2">
                                                <img class="o_avatar o_portal_contact_img rounded" t-att-src="image_data_uri(doc.user_id.avatar_128)"/>
                                                <h6 class="mb-0" t-field="doc.user_id.name"></h6>
                                            </div>
                                            <div t-out="doc.user_id" t-options='{"widget": "contact", "fields": ["email", "phone"]}'/>
                              </div>
                            </div>
                        </div>
                    </t>
                </t>
              <!-- Page content -->
              <div id="fund_content" class="o_portal_content col-12 col-lg-9 col-xl-8">

                  <!-- status messages -->
                  <div t-if="doc.state == 'cancel'" class="alert alert-danger alert-dismissable d-print-none" role="alert">
                      <strong>This fund has been canceled.</strong>
                  </div>

                  <!-- main content -->
                  <div id="card">
                      <div t-call="grant_portal.grant_fund_portal_content"/>
                  </div>
                  
                  <hr/>
                  <!-- chatter -->
                  <div id="fund_chat" data-anchor="true">
                        <h3>History</h3>
                        <t t-call="portal.message_thread">
                            <t t-set="object" t-value="doc"/>
                        </t>
                  </div>
              </div><!-- // #quote_content -->
          </div>
      </xpath>
  </template>
    <template id="requirement" name="Requirement" inherit_id="portal.portal_sidebar" primary="True">
      <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
<!--           <t t-set="o_portal_fullwidth_alert" groups="grant.group_grant_user">
              <t t-call="portal.portal_back_in_edit_mode">
                  <t t-set="backend_url" t-value="'/web#model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (grant._name, proposal.id, proposal.env.ref('purchase.purchase_rfq').id)"/>
              </t>
          </t> -->

          <div class="row mt16 o_portal_proposal_sidebar">
              <!-- Sidebar -->
              <t t-call="portal.portal_record_sidebar">
                  <t t-set="classes" t-value="'col-lg-auto d-print-none'"/>

                  <t t-set="title">
                      <h2 class="mb-0"><b t-field="doc.name" data-id="name"/> </h2>
                  </t>
                  <t t-set="entries">
                      <ul class="list-group list-group-flush flex-wrap flex-row flex-lg-column">
                          <li class="list-group-item flex-grow-1">
							<t t-if="doc.state in ('open', 'revise')">
								<form method="GET" t-attf-action="/requirement/submit" >
									<input type="hidden" name="requirement_id"  t-attf-value="#{doc.id}"/>
									<button class="btn btn-primary">Submit</button>
								</form>
							</t>
<!--                               <div class="o_download_pdf btn-toolbar flex-sm-nowrap">
                                  <div class="btn-group flex-grow-1 mr-1 mb-1">
                                      <a class="btn btn-secondary btn-block o_download_btn" t-att-href="doc.get_portal_url(report_type='pdf', download=True)" title="Download"><i class="fa fa-download"/> Download</a>
                                  </div>
                                  <div class="btn-group flex-grow-1 mb-1">
                                      <a class="btn btn-secondary btn-block o_print_btn o_portal_proposal_print" t-att-href="doc.get_portal_url(report_type='pdf')" id="print_invoice_report" title="Print" target="_blank"><i class="fa fa-print"/> Print</a>
                                  </div>
                              </div> -->
                          </li>

                          <li class="navspy list-group-item pl-0 flex-grow-1" t-ignore="true" role="complementary">
                              <ul class="nav flex-column bs-sidenav"></ul>
                          </li>

                           <li t-if="doc.user_id" class="list-group-item flex-grow-1">
                              <div class="small mb-1"><strong class="text-muted">Grant officer</strong></div>
                              <div class="row flex-nowrap">
                                  <div class="col flex-grow-0 pr-2">
                                      <img class="rounded-circle mr4 float-left o_portal_contact_img" t-att-src="image_data_uri(doc.user_id.avatar_1024)" alt="Contact"/>
                                  </div>
                                  <div class="col pl-0" style="min-width: 150px">
                                      <span t-field="doc.user_id" t-options='{"widget": "contact", "fields": ["name", "phone"], "no_marker": True}'/>
                                      <a href="#discussion" class="small"><i class="fa fa-comment"></i> Send message</a>
                                  </div>
                              </div>
                          </li>   
                      </ul>
                  </t>
              </t>

              <!-- Page content -->
              <div id="requirement_content" class="col-12 col-lg justify-content-end">

                  <!-- status messages -->
                  <div t-if="doc.state == 'cancel'" class="alert alert-danger alert-dismissable d-print-none" role="alert">
                      <strong>This fund has been canceled.</strong>
                  </div>

                  <!-- main content -->
                  <div t-attf-class="card #{'pb-5' if report_type == 'html' else ''}" id="portal_requirement_content">
                      <div t-call="grant_portal.grant_requirement_portal_content"/>
                  </div>

                  <!-- chatter -->
                  <div id="requirement_communication" class="mt-4">
                      <h2>History</h2>
                      <t t-call="portal.message_thread">
                          <t t-set="object" t-value="doc"/>
                      </t>
                  </div>
              </div><!-- // #quote_content -->
          </div>
      </xpath>
  </template>
  
    <template id="proposal_portal_layout" name="Portal breadcrumb: proposals" inherit_id="portal.portal_breadcrumbs" >
      <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
        <li t-if="page_name == 'grant-proposals' or page_name == 'proposal'" class="col-lg-2" t-attf-class="breadcrumb-item #{'active ' if not doc else ''}">
          <a t-if="doc" t-attf-href="/my/proposals?{{ keep_query() }}">Proposals</a>
            <t t-else="">Proposals</t>
        </li>
		<li t-if="page_name == 'grant-funds' or page_name == 'fund'" class="col-lg-2" t-attf-class="breadcrumb-item #{'active ' if not doc else ''}">
          <a t-if="doc" t-attf-href="/my/funds?{{ keep_query() }}">Funds</a>
            <t t-else="">Funds</t>
        </li>
		<li t-if="page_name == 'requirement'" class="col-lg-2" t-attf-class="breadcrumb-item #{'active ' if not doc else ''}">
          <a t-if="doc" t-attf-href="/my/funds?{{ keep_query() }}">Funds</a>
            <t t-else="">Funds</t>
        </li>
		<li t-if="page_name == 'requirement'" class="col-lg-2" t-attf-class="breadcrumb-item #{'active ' if not doc else ''}">
          <a t-if="doc" t-attf-href="/my/funds/{{doc.fund_id.id}}"><span t-esc="doc.fund_id.name"/></a>
        </li>
        <li t-if="doc" class="breadcrumb-item active text-truncate col-6 col-lg-6">
          <t t-esc="doc.name"/>
        </li>
      </xpath>
    </template>
    
    <template id="apply">
        <t t-call="website.layout">
            <t t-set="additional_title">Apply for Call</t>

            <div id="wrap"  class="container">
                <h1 class="text-center mt-2">
                    Grant Application Form
                </h1>
                <h2 t-if="call" class="text-center text-muted">
                    <span t-field="call.name"/>
                    <span t-if="call.code">(<span t-field="call.code" />)</span>
                </h2>
                <div t-if="call.state =='open'" id="proposal_section">
                    <section id="forms" class="s_website_form" data-vcss="001" data-snippet="s_website_form">
                        <div class="container">
                        <form
                            action="/submitted/proposal"
                            method="POST"
                            class="form-horizontal mt32"
                            enctype="multipart/form-data"
                        >
                            <input
                                type="hidden"
                                name="csrf_token"
                                t-att-value="request.csrf_token()"
                            />
                            
                            <input 
                                type="hidden"
                                name="call_id" 
                                t-att-value="call.id" />
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Company</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="text"
                                        class="form-control"
                                        name="company"
                                        required="True"
                                        data-fill-with="commercial_company_name"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Organization Email</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="text"
                                        class="form-control"
                                        name="company_email"
                                        required="True"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Contact name</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="text"
                                        class="form-control"
                                        name="partner_name"
                                        required="True"
                                        data-fill-with="name"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Contact email</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="text"
                                        class="form-control"
                                        name="partner_email"
                                        required="True"
                                        data-fill-with="email"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Contact phone</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="text"
                                        class="form-control"
                                        name="partner_phone"
                                        required="True"
                                        data-fill-with="phone"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Project title</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="text"
                                        class="form-control"
                                        name="title"
                                        required="True"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Project summary</label>
                                <div class="col-md-7 col-sm-8">
                                    <textarea 
                                        class="form-control"
                                        name="description"
                                        required="True"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Amount requested</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="number"
                                        class="form-control"
                                        name="amount_requested"
                                        required="True"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                                <label
                                    class="col-md-3 col-sm-4 control-label"
                                    for="company"
                                >Proposal</label>
                                <div class="col-md-7 col-sm-8">
                                    <input
                                        type="file"
                                        class="form-control"
                                        name="proposal"
                                        required="True"
                                        t-attf-accept=".pdf, .doc, .docx"
                                    />
                                </div>
                            </div>
                            <div class="form-group">
                            <label
                                class="col-md-3 col-sm-4 control-label"
                                for="company"
                            >Budget</label>
                            <div class="col-md-7 col-sm-8">
                                <input
                                    type="file"
                                    class="form-control"
                                    name="budget"
                                    required="True"
                                    t-attf-accept=".xls, .xlsx"
                                />
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="col-md-offset-3 col-sm-offset-4 col-sm-8 col-md-7">
                                <button class="btn btn-primary btn-lg">Submit</button>
                            </div>
                        </div>
                    </form>
                        </div>
                    </section>
                </div>
                <div t-else="" id="proposal_section">
                    <p>This form is no longer available.</p>
                </div>
                <div class="oe_structure mt-2"/>
            </div>
        </t>
    </template>

    <!--
    Grant Portal content : intro, informations, remarks, descriptions ....
    This template should contains all the printable element of the Proposal. This is the
    template rendered in PDF with the report engine.
    -->
    <template id="grant_proposal_portal_content" name="Grant Proposal Portal Content">
        <!-- Intro -->
        <div id="introduction" t-attf-class="pb-2 pt-3 card-header bg-white">
          <h2 class="my-0">
                <t t-esc="doc.title"/>
            </h2>
        </div>

        <div t-attf-class="card-body">

            <div id="informations">
                <div class="row" >
                    <div class="mb-3 col-12">
                        <strong>State:</strong>
                      <span t-field="doc.state" class="badge badge-pill badge-info" />
                    </div>
                </div>                
                <div class="row" t-if="doc.call_id">
                    <div class="mb-3 col-12">
                        <strong>Call:</strong>
                      <span t-field="doc.call_id" />
                    </div>
                </div>
                <div class="row" t-if="doc.call_id">
                    <div class="mb-3 col-12">
                        <strong>Decision expected:</strong>
                      <span t-field="doc.date_decision" />
                    </div>
                </div>
                <div class="row" t-if="doc.applicant_id">
                    <div class="mb-3 col-12">
                        <strong>Applicant:</strong>
                        <address t-field="doc.applicant_id" t-options='{"widget": "contact", "fields": ["name", "email"], "no_marker": True}'/>
                    </div>
                </div>
                <div class="row" t-if="doc.applicant_contact_id">
                    <div class="mb-3 col-12">
                        <strong>Applicant contact:</strong>
                        <address t-field="doc.applicant_contact_id" t-options='{"widget": "contact", "fields": ["name", "email"], "no_marker": True}'/>
                    </div>
                </div>
                <div class="row" t-if="doc.partner_ids">
                    <div class="mb-3 col-12">
                        <strong>Partners:</strong>
                        <address t-field="doc.partner_ids" t-options='{"widget": "contact", "fields": ["name","email"], "no_marker": True}'/>
                    </div>
                </div> 

                <div class="row" t-if="doc.date_submitted">
                    <div class="mb-3 col-12">
                        <strong>Date submitted:</strong>
                      <span t-field="doc.date_submitted" t-options='{"widget": "date"}'/>
                    </div>
                </div>
                <div class="row" t-if="doc.amount_requested">
                    <div class="mb-3 col-12">
                        <strong>Amount requested:</strong>
                      <span t-field="doc.amount_requested" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                    </div>
                </div>
                <div class="row" t-if="doc.description">
                    <div class="mb-3 col-12">
                        <strong>Summary:</strong>
                      <span t-field="doc.description" />
                    </div>
                </div>
                <div class="row" t-if="doc.fund_ids">
                    <div class="mb-3 col-12">
                        <strong>Related fund:</strong>
                            <ul >
                                <li t-foreach='doc.fund_ids' t-as='fund'>
                                    <a t-attf-href="/my/funds/{{fund.id}}">
                                        <span t-field="fund.name" />
                                    </a>
                                </li>
                            </ul>
                    </div>
                </div>
                <div t-call="grant_portal.grant_portal_attachments"/>
            </div>
        </div> 
    </template>
        <!--
    Grant Portal content : intro, informations, remarks, descriptions ....
    This template should contains all the printable element of the Proposal. This is the
    template rendered in PDF with the report engine.
    -->
    <template id="grant_fund_portal_content" name="Grant Fund Portal Content">
                        <div id="card_header" data-anchor="true">
                            <div class="row justify-content-between align-items-end mb-3">
                                <div class="col-12 col-md-9">
                                    <div class="d-flex align-items-center gap-2">
                                        <h3 t-field="doc.title" class="text-truncate my-0"/>
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <span t-field="doc.state" t-attf-class="badge #{'text-bg-success' if doc.state in ('close', 'open') else 'text-bg-warning' if doc.state in ('draft', 'done') else 'text-bg-info'} fw-normal o_text_overflow" title="Current state of this fund"/>
                                </div>
                            </div>
                        </div>
                        <div id="card_body">
                            <div id="informations">
                                <div class="row" t-if="doc.commercial_partner_id">
                                    <div class="mb-3 col-12">
                                        <strong>Grantee:</strong>
                                        <address t-field="doc.commercial_partner_id" t-options='{"widget": "contact", "fields": ["name", "email"], "no_marker": True}'/>
                                    </div>
                                </div>
                                <div class="row" t-if="doc.partner_id">
                                    <div class="mb-3 col-12">
                                        <strong>Grantee contact:</strong>
                                        <address t-field="doc.partner_id" t-options='{"widget": "contact", "fields": ["name", "email"], "no_marker": True}'/>
                                    </div>
                                </div>
                                <div class="row" t-if="doc.date_start">
                                    <div class="mb-3 col-12">
                                        <strong>Start Date:</strong>
                                      <span t-field="doc.date_start" t-options='{"widget": "date"}'/>
                                    </div>
                                </div>
                                <div class="row" t-if="doc.date">
                                    <div class="mb-3 col-12">
                                        <strong>End Date:</strong>
                                      <span t-field="doc.date" t-options='{"widget": "date"}'/>
                                    </div>
                                </div>
                                <div class="row" t-if="doc.amount_requested">
                                    <div class="mb-3 col-12">
                                        <strong>Amount granted:</strong>
                                      <span t-field="doc.amount_granted" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                    </div>
                                </div>
                                <div class="row" t-if="doc.amount_requested">
                                    <div class="mb-3 col-12">
                                        <strong>Financial cofinancing:</strong>
                                      <span t-field="doc.cofinannce" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                    </div>
                                </div>
                                <div class="row" t-if="doc.amount_requested">
                                    <div class="mb-3 col-12">
                                        <strong>Inkind cofinancing:</strong>
                                      <span t-field="doc.cofinannce_inkind" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>
                                    </div>
                                </div>
                                <div class="row" t-if="doc.description">
                                    <div class="mb-3 col-12">
                                        <strong>Summary:</strong>
                                      <span t-field="doc.description" />
                                    </div>
                                </div>
                                <div class="row" t-if="doc.proposal_id">
                                    <div class="mb-3 col-12">
                                        <strong>Proposal:</strong>
                                      <a t-attf-href="/my/proposals/{{doc.proposal_id.id}}">
                                        <span t-field="doc.proposal_id" />
                                      </a>
                                    </div>
                                </div>
                            </div>
                            <t t-set="requirements" t-value="[r for r in doc.requirement_ids if r.state not in ['cancel']]"/>
                            <div t-if="requirements" class="row">
                                <div class="col">
                                    <strong class="d-block mb-1">Requirements</strong>
                                    <ul class="list-group mb-4">
                                        <t t-foreach="requirements" t-as="r">
                                            <div class="d-flex flex-wrap align-items-center justify-content-between">
                                                <div>
                                                    <a t-attf-href="/my/requirements/{{r.id}}">
                                                        <span t-esc="r.name"/>
                                                    </a>
                                                    <div class="small d-lg-inline-block">Due: <span class="text-muted" t-field="r.date_due"/></div>
                                                </div>
                                                <span t-if="r.state in ('draft')" class="small badge badge-secondary orders_label_text_align"><i class="fa fa-fw fa-clock-o"/> <b>Scheduled</b></span>
                                                <span t-if="r.state in ('open', 'revise')" class="small badge badge-danger orders_label_text_align"><i class="fa fa-fw fa-clock-o"/> <b>To be submitted</b></span>
                                                <span t-if="r.state in ('done')" class="small badge badge-warning orders_label_text_align"><i class="fa fa-fw fa-check"/> <b>Submitted</b></span>
                                                <span t-if="r.state in ('close')" class="small badge badge-success orders_label_text_align"><i class="fa fa-fw fa-check"/> <b>Accepted</b></span>
                                            </div>
                                        </t>
                                    </ul>
                                </div>
                            </div>
                            <t t-set="installments" t-value="[i for i in doc.installment_ids if i.state not in ['cancel']]"/>
                            <div t-if="installments" class="row">
                                <div class="col">
                                    <strong class="d-block mb-1">Installments</strong>
                                    <ul class="list-group mb-4">
                                        <t t-foreach="installments" t-as="i">
                                            <div class="d-flex flex-wrap align-items-center justify-content-between">
                                                <div>
                                                    <t t-if="i.narration">
                                                        <t t-esc="env['ir.fields.converter'].text_from_html(i.narration)"/>
                                                    </t>
                                                    <t t-else="">
                                                        <span t-esc="i.name"/>
                                                    </t>
                                                    <t t-if="i.amount_total_in_currency_signed">
                                                        (<span t-esc="abs(i.amount_total_in_currency_signed)" t-options='{"widget": "monetary", "display_currency": doc.currency_id}'/>)
                                                    </t>
                                                    <div class="small d-lg-inline-block">Due: <span class="text-muted" t-field="i.invoice_date_due"/></div>
                                                </div>
                                                <span t-if="i.state in ('draft')" class="small badge badge-secondary orders_label_text_align"><i class="fa fa-fw fa-clock-o"/> <b>Scheduled</b></span>
                                                <span t-if="i.state in ('posted')" class="small badge badge-warning orders_label_text_align"><i class="fa fa-fw fa-clock-o"/> <b>Payment due</b></span>
                                                <span t-if="i.payment_state in ('paid')" class="small badge badge-success orders_label_text_align"><i class="fa fa-fw fa-check"/> <b>Accepted</b></span>
                                            </div>
                                        </t>
                                    </ul>
                                </div>
                            </div>
                        </div>
    </template>
    <template id="grant_portal_attachments" name="Grant Portal Attachments">
        
            <div
                t-if="doc.attachment_ids"
                >
                <strong class="d-block mb-2">Attachments</strong>
                <div class="row">
                    <div
                        t-attf-class="col col-12 col-lg-12 o_project_portal_attachments"
                    >
                        <ul class="list-group">
                            <a
                                class="list-group-item list-group-item-action d-flex align-items-center oe_attachments py-1 px-2"
                                t-foreach='doc.attachment_ids'
                                t-as='attachment'
                                t-attf-href="/web/content/#{attachment.id}?download=true&amp;access_token=#{attachment.access_token}"
                                target="_blank"
                                data-no-post-process=""
                            >
                                <div
                                    class='oe_attachment_embedded o_image o_image_small mr-2 mr-lg-3'
                                    t-att-title="attachment.name"
                                    t-att-data-mimetype="attachment.mimetype"
                                    t-attf-data-src="/web/image/#{attachment.id}/50x40?access_token=#{attachment.access_token}"
                                />
                                <div
                                    class='oe_attachment_name text-truncate'
                                ><t t-esc='attachment.name' /></div>
                            </a>
                        </ul>
                    </div>
                </div>
        </div>
    </template>
    <template id="grant_requirement_portal_content" name="Grant Requirement Portal Content">
        <!-- Intro -->
        <div id="introduction" t-attf-class="pb-2 pt-3 card-header bg-white">
          <h2 class="my-0">
                <t t-esc="doc.name"/>
            </h2>
        </div>

        <div t-attf-class="card-body">

            <div id="informations">
                <div class="row" >
                    <div class="mb-3 col-6">
                        <strong>State:</strong>
                      <span t-field="doc.state" class="badge badge-pill badge-info" />
                    </div>
                </div>
                <div class="row" t-if="doc.type">
                    <div class="mb-3 col-6">
                        <strong>Type:</strong>
                        <span t-field="doc.type" />
                    </div>
                </div>
				<div class="row" t-if="doc.reportcontent_ids">
                    <div class="mb-3 col-6">
                        <strong>Content:</strong>
                        <span t-if="len(doc.reportcontent_ids) > 0" class="col-12 col-sm order-sm-2 o_wforum_index_entry_tags mb-1">
                            <a t-foreach="doc.reportcontent_ids" t-as="content_tag"
                                t-attf-class="badge border text-600 badge-light #{not content_tag_first and 'ml-1'}"
                                t-field="content_tag.name"/>
                        </span>
                    </div>
                </div>
                <div class="row" t-if="doc.date_due">
                    <div class="mb-3 col-6">
                        <strong>Due:</strong>
                        <span t-field="doc.date_due" t-options='{"widget": "date"}'/>
                    </div>
                </div>
                <div class="row" t-if="doc.date_open">
                    <div class="mb-3 col-6">
                        <strong>Start Date:</strong>
                      <span t-field="doc.date_open" t-options='{"widget": "date"}'/>
                    </div>
                </div>
                <div class="row" t-if="doc.date_close">
                    <div class="mb-3 col-6">
                        <strong>End Date:</strong>
                      <span t-field="doc.date_close" t-options='{"widget": "date"}'/>
                    </div>
                </div>
				<div class="row" t-if="doc.date_submit">
                    <div class="mb-3 col-6">
                        <strong>Submitted:</strong>
                      <span t-field="doc.date_submit" t-options='{"widget": "date"}'/>
                    </div>
                </div>
                <div t-call="grant_portal.grant_portal_attachments"/>
            </div>
        </div>
    </template>
</odoo>
