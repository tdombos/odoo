<?xml version="1.0"?>
<openerp>
    <data>
    

    <record model="ir.actions.act_window" id="action_grant_proposaltocall">
        <field name="name">Proposals</field>
        <field name="res_model">grant.proposal</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('call_id','=',[active_id])]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_requirementtogrant">
        <field name="name">Requirements</field>
        <field name="res_model">grant.requirement</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">[('fund_id','=',[active_id])]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_createproposal">
        <field name="name">Proposals</field>
        <field name="res_model">grant.proposal</field>
        <field name="view_mode">form,tree</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_partnertofund">
            <field name="name">Partners</field>
            <field name="res_model">project_partner.partnerline</field>
            <field name="view_mode">tree</field>
            <field name="domain">[('project_id','=',[project_id])]</field>
        </record>
    <!-- Fund Search View-->
    <record model="ir.ui.view" id="view_grant_fund_search">
        <field name="name">grant.fund.search</field>
        <field name="model">grant.fund</field>
        <field name="arch" type="xml">
            <search string="Call">
                <field name="name" string="Name"/>
				<field name="partner_id" string="Applicant"/>
                <field name="donor_id" string="Donor"/>
				<field name="tag_ids" string="Tags"/>
                <filter name="open" string="Open" domain="[('state','in', ['draft', 'open', 'done'])]" help="Open funds" />
				<group expand="0" string="Group By">
					<filter string="State" name="state" context="{'group_by': 'state'}" />
					<filter string="Responsible" name="user_id" context="{'group_by': 'user_id'}" />
                </group>
            </search>
        </field>
    </record>	
	<!-- Fund Tree View -->
        <record model="ir.ui.view" id="view_grant_fund_tree">
            <field name="name">grant.fund.tree</field>
            <field name="model">grant.fund</field>
            <field name="arch" type="xml">
                <tree string="Funds">
                    <field name="name" string="Code"/>
                    <field name="title"/>
                    <field name="call_id"/>
                    <field name="commercial_partner_id" string="Applicant"/>
					<field name="user_id" string="Responsible" widget="many2one_avatar_user" />
					<field name="activity_ids" widget="list_activity"/>
                    <field name="state"
						widget="badge"
						decoration-success="state in ('open','close')"
						decoration-warning="state in ('draft','done')" />
                </tree>
            </field>
        </record>
    <!-- Installment Form View -->
         <record id="view_grant_installment_form" model="ir.ui.view">
            <field name="name">account.move.form</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <form string="Account Entry" js_class="account_move_form">
                    <header>
                        <!-- Post -->
                        <button name="action_post" string="Post" class="oe_highlight"
                                type="object" groups="account.group_account_invoice" data-hotkey="q"
                                context="{'validate_analytic': True}"
                                invisible="hide_post_button or move_type != 'entry'"/>
                        <button name="action_post" string="Confirm" class="oe_highlight"
                                type="object" groups="account.group_account_invoice" data-hotkey="q"
                                context="{'validate_analytic': True}"
                                invisible="hide_post_button or move_type == 'entry' or display_inactive_currency_warning"/>
                        <!-- Send (only invoices) -->
                        <button name="action_invoice_sent"
                                type="object"
                                string="Send &amp; Print"
                                invisible="state != 'posted' or is_being_sent or invoice_pdf_report_id or move_type not in ('out_invoice', 'out_refund')"
                                class="oe_highlight"
                                data-hotkey="y"/>
                        <button name="action_invoice_sent"
                                type="object"
                                string="Send &amp; Print"
                                invisible="state != 'posted' or not is_being_sent and not invoice_pdf_report_id or move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund')"
                                data-hotkey="y"/>
                        <!-- Register Payment (only invoices / receipts) -->
                        <button name="action_register_payment" id="account_invoice_payment_btn"
                                type="object" class="oe_highlight"
                                invisible="state != 'posted' or payment_state not in ('not_paid', 'partial') or move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"
                                context="{'dont_redirect_to_payments': True, 'display_account_trust': True}"
                                string="Register Payment" data-hotkey="g"
                                groups="account.group_account_invoice"/>
                        <!-- Preview (only customer invoices) -->
                        <button name="preview_invoice" type="object" string="Preview" data-hotkey="o"
                                title="Preview invoice"
                                invisible="move_type not in ('out_invoice', 'out_refund')"/>
                        <!-- Reverse -->
                        <button name="%(account.action_view_account_move_reversal)d" string="Reverse Entry"
                                type="action" groups="account.group_account_invoice" data-hotkey="z"
                                invisible="move_type != 'entry' or state != 'posted' or payment_state == 'reversed'"/>
                        <button name="action_reverse" string='Credit Note'
                                type='object' groups="account.group_account_invoice"
                                invisible="move_type not in ('out_invoice', 'in_invoice') or state != 'posted'"/>
                        <!-- Cancel -->
                        <button name="button_cancel" string="Cancel Entry" type="object" groups="account.group_account_invoice" data-hotkey="x"
                                invisible="not id or state != 'draft' or move_type != 'entry'"/>
                        <button name="button_cancel" string="Cancel" type="object" groups="account.group_account_invoice" data-hotkey="x"
                                invisible="not id or state != 'draft' or move_type == 'entry'"/>
                        <button name="button_draft" string="Reset to Draft" type="object" groups="account.group_account_invoice"
                                invisible="not show_reset_to_draft_button" data-hotkey="r" />
                        <button string="Request Cancel"
                                name="button_request_cancel"
                                type="object"
                                groups="account.group_account_invoice"
                                invisible="state != 'posted' or show_reset_to_draft_button or not need_cancel_request"
                                data-hotkey="w"/>

                        <!-- Set as Checked -->
                        <button name="button_set_checked" string="Set as Checked" type="object" groups="account.group_account_invoice"
                                invisible="not to_check" data-hotkey="k" />
                        <field name="state" widget="statusbar" statusbar_visible="draft,posted"/>
                    </header>
                    <div class="alert alert-warning" role="alert"
                         invisible="state != 'draft' or not duplicated_ref_ids">
                        Warning: this bill might be a duplicate of
                        <button name="open_duplicated_ref_bill_view"
                                type="object"
                                string="one of those bills"
                                class="btn btn-link p-0"
                        />
                    </div>
                    <div class="alert alert-info" role="alert" invisible="not is_being_sent">
                        This invoice is being sent in the background.
                    </div>
                    <!-- Invoice outstanding credits -->
                    <div groups="account.group_account_invoice,account.group_account_readonly"
                         class="alert alert-warning" role="alert"
                         invisible="state != 'draft' or not tax_lock_date_message">
                        <field name="tax_lock_date_message" nolabel="1"/>
                    </div>
                    <div groups="account.group_account_invoice,account.group_account_readonly"
                         class="alert alert-info" role="alert"
                         invisible="move_type not in ('out_invoice', 'out_receipt') or not invoice_has_outstanding or payment_state not in ('not_paid', 'partial')">
                        You have <bold><a class="alert-link" href="#outstanding" role="button">outstanding credits</a></bold> for this customer. You can allocate them to mark this invoice as paid.
                    </div>
                    <div groups="account.group_account_invoice,account.group_account_readonly"
                         class="alert alert-info" role="alert"
                         invisible="move_type not in ('in_invoice', 'in_receipt') or not invoice_has_outstanding or payment_state not in ('not_paid', 'partial')">
                        You have <bold><a class="alert-link" href="#outstanding" role="button">outstanding debits</a></bold> for this vendor. You can allocate them to mark this bill as paid.
                    </div>
                    <div groups="account.group_account_invoice,account.group_account_readonly"
                         class="alert alert-info" role="alert"
                         invisible="move_type != 'out_refund' or not invoice_has_outstanding or payment_state not in ('not_paid', 'partial')">
                        You have <bold><a class="alert-link" href="#outstanding" role="button">outstanding debits</a></bold> for this customer. You can allocate them to mark this credit note as paid.
                    </div>
                    <div groups="account.group_account_invoice,account.group_account_readonly"
                         class="alert alert-info" role="alert"
                         invisible="move_type != 'in_refund' or not invoice_has_outstanding or payment_state not in ('not_paid', 'partial')">
                        You have <bold><a class="alert-link" href="#outstanding" role="button">outstanding credits</a></bold> for this vendor. You can allocate them to mark this credit note as paid.
                    </div>
                    <div class="alert alert-info" role="alert"
                         invisible="state != 'draft' or auto_post != 'at_date'">
                        This move is configured to be posted automatically at the accounting date: <field name="date" readonly="1"/>.
                    </div>
                    <div class="alert alert-info" role="alert"
                         invisible="state != 'draft' or auto_post == 'no' or auto_post == 'at_date'">
                         <field name="auto_post" readonly="1"/> auto-posting enabled. Next accounting date: <field name="date" readonly="1"/>.<span invisible="not auto_post_until"> The recurrence will end on <field name="auto_post_until" readonly="1"/> (included).</span>
                    </div>
                    <div groups="account.group_account_invoice,account.group_account_readonly"
                         class="alert alert-warning" role="alert"
                         invisible="partner_credit_warning == ''">
                        <field name="partner_credit_warning"/>
                    </div>
                    <!-- Currency consistency -->
                    <div class="alert alert-warning" role="alert"
                         invisible="not display_inactive_currency_warning or move_type not in ('in_invoice', 'in_refund', 'in_receipt')">
                        In order to validate this bill, you must <button class="oe_link" type="object" name="action_activate_currency" style="padding: 0; vertical-align: baseline;">activate the currency of the bill</button>. The journal entries need to be computed by Odoo before being posted in your company's currency.
                    </div>
                    <div class="alert alert-warning" role="alert"
                         invisible="not display_inactive_currency_warning or move_type not in ('out_invoice', 'out_refund', 'out_receipt')">
                        In order to validate this invoice, you must <button class="oe_link" type="object" name="action_activate_currency" style="padding: 0; vertical-align: baseline;">activate the currency of the invoice</button>. The journal entries need to be computed by Odoo before being posted in your company's currency.
                    </div>
                    <sheet>
                        <div name="button_box" class="oe_button_box">
                            <button name="action_open_business_doc"
                                    class="oe_stat_button"
                                    icon="fa-bars"
                                    type="object"
                                    invisible="move_type != 'entry' or not id or not payment_id">
                                    <div class="o_stat_info">
                                        <span class="o_stat_text">1 Payment</span>
                                    </div>
                            </button>
                            <button name="open_reconcile_view"
                                    class="oe_stat_button"
                                    icon="fa-bars"
                                    type="object"
                                    invisible="move_type != 'entry' or not id or not has_reconciled_entries">
                                    <div class="o_stat_info">
                                        <span class="o_stat_text">Reconciled Items</span>
                                    </div>
                            </button>
                            <button name="open_created_caba_entries"
                                    class="oe_stat_button"
                                    icon="fa-usd"
                                    type="object"
                                    invisible="not tax_cash_basis_created_move_ids">
                                    <div class="o_stat_info">
                                        <span class="o_stat_text">Cash Basis Entries</span>
                                    </div>
                            </button>
                        </div>

                        <!-- Payment status for invoices / receipts -->
                        <widget name="web_ribbon" title="Paid"
                                invisible="payment_state != 'paid' or move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"/>
                        <widget name="web_ribbon" title="In Payment"
                                invisible="payment_state != 'in_payment' or move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"/>
                        <widget name="web_ribbon" title="Partial"
                                invisible="payment_state != 'partial' or move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"/>
                        <widget name="web_ribbon" title="Reversed"
                                bg_color="text-bg-danger"
                                invisible="payment_state != 'reversed'"/>
                         <widget name="web_ribbon" text="Invoicing App Legacy"
                                bg_color="text-bg-info"
                                invisible="payment_state != 'invoicing_legacy'"
                                tooltip="This entry has been generated through the Invoicing app, before installing Accounting. It has been disabled by the 'Invoicing Switch Threshold Date' setting so that it does not impact your accounting."/>

                        <!-- Invisible fields -->
                        <field name="id" invisible="1"/>
                        <field name="state" invisible="1"/>
                        <field name="company_id" invisible="1"/>
                        <field name="journal_id" invisible="1"/>
                        <field name="show_name_warning" invisible="1"/>
                        <field name="posted_before" invisible="1"/>
                        <!--test-tags .test_01_account_tour -->
                        <field name="move_type" invisible="1" force_save="1"/>
                        <field name="payment_state" invisible="1" force_save="1"/>
                        <field name="invoice_filter_type_domain" invisible="1"/>
                        <field name="suitable_journal_ids" invisible="1"/>
                        <field name="currency_id" invisible="1" readonly="state in ['cancel', 'posted']"/>
                        <field name="company_currency_id" invisible="1"/>
                        <field name="commercial_partner_id" invisible="1"/>
                        <field name="bank_partner_id" invisible="1"/>
                        <field name="display_qr_code" invisible="1"/>
                        <field name="show_reset_to_draft_button" invisible="1"/>

                        <field name="invoice_has_outstanding" invisible="1"/>
                        <field name="is_move_sent" invisible="1"/>
                        <field name="invoice_pdf_report_id" invisible="1"/>
                        <field name="need_cancel_request" invisible="1"/>
                        <field name="has_reconciled_entries" invisible="1"/>
                        <field name="restrict_mode_hash_table" invisible="1"/>
                        <field name="inalterable_hash" invisible="1"/>
                        <field name="country_code" invisible="1"/>
                        <field name="display_inactive_currency_warning" invisible="1"/>
                        <field name="statement_line_id" invisible="1"/>
                        <field name="statement_id" invisible="1"/>
                        <field name="payment_id" invisible="1"/>
                        <field name="tax_country_id" invisible="1"/>
                        <field name="tax_calculation_rounding_method" invisible="1"/>
                        <field name="tax_cash_basis_created_move_ids" invisible="1"/>
                        <field name="quick_edit_mode" invisible="1"/>
                        <field name="hide_post_button" invisible="1"/>
                        <field name="duplicated_ref_ids" invisible="1"/>
                        <field name="quick_encoding_vals" invisible="1"/>
                        <field name="show_delivery_date" invisible="1"/>
                        <field name="is_being_sent" invisible="1"/>

                        <div class="oe_title">
                            <span class="o_form_label"><field name="move_type" readonly="1" invisible="move_type == 'entry'" nolabel="1"/></span>

                            <div class="text-warning" invisible="not show_name_warning">The current highest number is <field class="oe_inline" name="highest_name"/>. You might want to put a higher number here.</div>

                            <h1>
                                <field name="name" invisible="name == '/' and not posted_before and not quick_edit_mode" readonly="state != 'draft'" placeholder="Draft"/>

                                <span invisible="state != 'draft' or name != '/' or posted_before or quick_edit_mode">Draft</span>
                            </h1>
                        </div>
                        <group>
                            <group id="header_left_group">

                                <label for="partner_id" string="Customer" style="font-weight:bold;"
                                       invisible="move_type not in ('out_invoice', 'out_refund', 'out_receipt')"/>
                                <label for="partner_id" string="Vendor" style="font-weight:bold;"
                                       invisible="move_type not in ('in_invoice', 'in_refund', 'in_receipt')"/>
                                <field name="partner_id" widget="res_partner_many2one" nolabel="1"
                                       context="{
                                            'res_partner_search_mode': (context.get('default_move_type', 'entry') in ('out_invoice', 'out_refund', 'out_receipt') and 'customer') or (context.get('default_move_type', 'entry') in ('in_invoice', 'in_refund', 'in_receipt') and 'supplier') or False,
                                            'show_address': 1, 'default_is_company': True, 'show_vat': True}"
                                       domain="[('company_id', 'in', (False, company_id))]"
                                       options='{"no_quick_create": True}'
                                       invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"
                                       readonly="state != 'draft'"/>

                                <field name="partner_shipping_id"
                                       groups="account.group_delivery_invoice_address"
                                       invisible="move_type not in ('out_invoice', 'out_refund', 'out_receipt')"
                                       readonly="state != 'draft'"/>
                                <field name="quick_edit_total_amount" class="w-50"
                                       invisible="move_type == 'entry' or not quick_edit_mode"
                                       readonly="state != 'draft'"/>
                                <label for="ref" string="Bill Reference"
                                       invisible="move_type not in ('in_invoice', 'in_receipt', 'in_refund')" />
                                <field name="ref" nolabel="1" invisible="move_type not in ('in_invoice', 'in_receipt', 'in_refund')" />
                                <field name="ref" invisible="move_type in ('in_invoice', 'in_receipt', 'in_refund', 'out_invoice', 'out_refund')"/>
                                <field name="tax_cash_basis_origin_move_id" invisible="not tax_cash_basis_origin_move_id"/>
                                <label name="invoice_vendor_bill_id_label" for="invoice_vendor_bill_id" string="Auto-Complete" class="oe_edit_only"
                                       invisible="state != 'draft' or move_type != 'in_invoice'"/>
                                <field name="invoice_vendor_bill_id" nolabel="1" class="oe_edit_only"
                                       invisible="state != 'draft' or move_type != 'in_invoice'"
                                       domain="[('company_id', '=', company_id), ('partner_id','child_of', [partner_id]), ('move_type','=','in_invoice')]"
                                       placeholder="Select an old vendor bill"
                                       options="{'no_create': True}" context="{'show_total_amount': True}"/>
                            </group>
                            <group id="header_right_group">

                                <!-- Invoice date (only invoices / receipts) -->
                                <label for="invoice_date" string="Invoice Date" style="font-weight:bold;"
                                       invisible="move_type not in ('out_invoice', 'out_refund', 'out_receipt')"/>
                                <label for="invoice_date" string="Bill Date" style="font-weight:bold;"
                                       invisible="move_type not in ('in_invoice', 'in_refund', 'in_receipt')"/>
                                <field name="invoice_date" nolabel="1" options="{'warn_future': true}"
                                       invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"
                                       readonly="state != 'draft'"/>

                                <field name="date" string="Accounting Date"
                                       invisible="move_type in ('out_invoice', 'out_refund', 'out_receipt') and not quick_edit_mode and not (state == 'posted' and date != invoice_date)"
                                       readonly="state != 'draft'"/>
                                <field name="payment_reference"
                                       invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"
                                       readonly="inalterable_hash != False"/>
                                <field name="partner_bank_id"
                                       context="{'default_partner_id': bank_partner_id, 'display_account_trust': True}"
                                       domain="[('partner_id', '=', bank_partner_id)]"
                                       invisible="move_type not in ('in_invoice', 'in_refund', 'in_receipt')"
                                       readonly="state != 'draft'"/>

                                <!-- Invoice payment terms (only invoices) + due date (only invoices / receipts) -->
                                <div class="o_td_label" invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')">
                                    <label for="invoice_date_due" string="Due Date"
                                           invisible="invoice_payment_term_id"/>
                                    <label for="invoice_payment_term_id" string="Payment terms"
                                           invisible="not invoice_payment_term_id"/>
                                </div>
                                <div class="d-flex" invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')" name="due_date">
                                    <field name="invoice_date_due" force_save="1"
                                           placeholder="Date"
                                           invisible="invoice_payment_term_id"/>
                                    <span class="o_form_label mx-3 oe_edit_only"
                                          invisible="state != 'draft' or invoice_payment_term_id"> or </span>
                                    <field name="invoice_payment_term_id"
                                           context="{'example_date': invoice_date, 'example_amount': tax_totals['amount_total']}"
                                           placeholder="Payment Terms"
                                           options="{'no_quick_create':True}" readonly="state in ['cancel', 'posted']"/>
                                </div>
                                <field name="delivery_date" invisible="not show_delivery_date" readonly="state != 'draft'"/>
                                <label for="journal_id"
                                       groups="account.group_account_readonly"
                                       invisible="context.get('default_journal_id') and context.get('move_type', 'entry') != 'entry'"/>
                                <div name="journal_div"
                                     class="d-flex"
                                     groups="account.group_account_readonly"
                                     invisible="context.get('default_journal_id') and context.get('move_type', 'entry') != 'entry'">
                                    <field name="journal_id"
                                        options="{'no_create': True, 'no_open': True}"
                                        readonly="posted_before"/>
                                    <span class="oe_inline o_form_label mx-3"
                                          groups="base.group_multi_currency"
                                          invisible="move_type == 'entry'"> in </span>
                                    <field name="currency_id"
                                           groups="base.group_multi_currency"
                                           invisible="move_type == 'entry'"
                                           readonly="state != 'draft'"
                                           options="{'no_create': True}"
                                           context="{'search_default_active': 1, 'search_default_inactive': 1}"/>
                                </div>

                                <field name="currency_id"
                                       readonly="state != 'draft'"
                                       groups="!account.group_account_readonly,base.group_multi_currency"
                                       options="{'no_create': True}"/>

                            </group>
                        </group>
                        <notebook>
                            <page id="invoice_tab"
                                  name="invoice_tab"
                                  string="Invoice Lines"
                                  invisible="move_type == 'entry'">
                                <field name="invoice_line_ids"
                                       widget="section_and_note_one2many"
                                       mode="tree,kanban"
                                       context="{
                                           'default_move_type': context.get('default_move_type'),
                                           'journal_id': journal_id,
                                           'default_partner_id': commercial_partner_id,
                                           'default_currency_id': currency_id or company_currency_id,
                                           'default_display_type': 'product',
                                           'quick_encoding_vals': quick_encoding_vals,
                                       }" readonly="state != 'draft'">
                                    <tree editable="bottom" string="Journal Items" default_order="sequence, id">
                                        <control>
                                            <create name="add_line_control" string="Add a line"/>
                                            <create name="add_section_control" string="Add a section" context="{'default_display_type': 'line_section'}"/>
                                            <create name="add_note_control" string="Add a note" context="{'default_display_type': 'line_note'}"/>
                                        </control>

                                        <!-- Displayed fields -->
                                        <field name="sequence" widget="handle"/>
                                        <field name="product_id"
                                               optional="show"
                                               widget="many2one_barcode"
                                               domain="
                                                    context.get('default_move_type') in ('out_invoice', 'out_refund', 'out_receipt')
                                                    and [('sale_ok', '=', True)]
                                                    or [('purchase_ok', '=', True)]
                                               "/>
                                        <field name="name" widget="section_and_note_text" optional="show"/>
                                        <field name="account_id" invisible="1" />
                                        <field name="analytic_distribution" widget="analytic_distribution"
                                               groups="analytic.group_analytic_accounting"
                                               optional="show"
                                               options="{'product_field': 'product_id', 'account_field': 'account_id', 'amount_field': 'price_subtotal'}"
                                               business_domain_compute="parent.move_type in ['out_invoice', 'out_refund', 'out_receipt'] and 'invoice' or parent.move_type in ['in_invoice', 'in_refund', 'in_receipt'] and 'bill' or 'general'"/>
                                        <field name="price_unit" string="Price"/>
                                        <!-- Others fields -->
                                        <field name="partner_id" column_invisible="True"/>
                                        <field name="currency_id" column_invisible="True"/>
                                        <field name="company_id" column_invisible="True"/>
                                        <field name="company_currency_id" column_invisible="True"/>
                                        <field name="display_type" force_save="1" column_invisible="True"/>
                                    </tree>
                                    <kanban class="o_kanban_mobile">
                                        <!-- Displayed fields -->
                                        <field name="name"/>
                                        <field name="product_id"/>
                                        <field name="price_subtotal"
                                               string="Tax excl."/>
                                        <field name="price_total"
                                               string="Tax incl."
                                               optional="hide"/>
                                        <field name="quantity"/>
                                        <field name="product_uom_category_id"/>
                                        <field name="product_uom_id" groups="uom.group_uom"/>
                                        <field name="price_unit"/>
                                        <templates>
                                            <t t-name="kanban-box">
                                                <div t-attf-class="oe_kanban_card oe_kanban_global_click ps-0 pe-0 {{ record.display_type.raw_value ? 'o_is_' + record.display_type.raw_value : '' }}">
                                                    <t t-if="!['line_note', 'line_section'].includes(record.display_type.raw_value)">
                                                        <div class="row g-0">
                                                            <div class="col-2 pe-3">
                                                                <img t-att-src="kanban_image('product.product', 'image_128', record.product_id.raw_value)" t-att-title="record.product_id.value" t-att-alt="record.product_id.value" style="max-width: 100%;"/>
                                                            </div>
                                                            <div class="col-10">
                                                                <div class="row">
                                                                    <div class="col">
                                                                        <strong t-out="record.product_id.value"/>
                                                                    </div>
                                                                    <div class="col-auto">
                                                                        <strong class="float-end text-end">
                                                                            <t t-out="record.price_subtotal.value"/>
                                                                            <t t-out="record.price_total.value" t-if="tax_calculation_rounding_method == 'round_per_line'"/>
                                                                        </strong>
                                                                    </div>
                                                                </div>
                                                                <div class="text-muted">
                                                                    Quantity:
                                                                    <t t-out="record.quantity.value"/>
                                                                    <t t-out="record.product_uom_id.value" groups="uom.group_uom"/>
                                                                </div>
                                                                <div class="text-muted">
                                                                    Unit Price:
                                                                    <t t-out="record.price_unit.value"/>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </t>
                                                    <t t-if="record.display_type.raw_value === 'line_section' || record.display_type.raw_value === 'line_note'">
                                                        <div class="row">
                                                            <div class="col-12">
                                                                <t t-out="record.name.value"/>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </t>
                                        </templates>

                                        <!-- Others fields -->
                                        <field name="tax_calculation_rounding_method"/>
                                        <field name="currency_id"/>
                                        <field name="company_currency_id"/>
                                        <field name="display_type" force_save="1"/>
                                    </kanban>

                                    <!-- Form view to cover mobile use -->
                                    <form>
                                        <sheet>
                                            <field name="tax_calculation_rounding_method" invisible="1"/>
                                            <field name="display_type" invisible="1"/>
                                            <field name="company_id" invisible="1"/>
                                            <field name="partner_id" invisible="1"/>
                                            <group>
                                                <field name="product_id" widget="many2one_barcode"/>
                                                <field name="quantity"/>
                                                <field name="product_uom_category_id" invisible="1"/>
                                                <field name="product_uom_id" groups="uom.group_uom"/>
                                                <field name="price_unit"/>
                                                <field name="discount" string="Disc.%"/>
                                            </group>
                                            <group>
                                                <field name="account_id" domain="[('company_id', 'parent_of', company_id), ('deprecated', '=', False)]" options="{'no_create': True}" context="{'partner_id': partner_id, 'move_type': parent.move_type}"/>
                                                <field name="tax_ids" widget="many2many_tags"/>
                                                <field name="analytic_distribution" widget="analytic_distribution" groups="analytic.group_analytic_accounting"/>
                                            </group>
                                            <label for="name" string="Description" invisible="display_type in ('line_note', 'line_section')"/>
                                            <label for="name" string="Section" invisible="display_type != 'line_section'"/>
                                            <label for="name" string="Note" invisible="display_type != 'line_note'"/>
                                            <field name="name" widget="text"/>
                                            <group>
                                                <field name="price_subtotal"
                                                       string="Tax excl."/>
                                                <field name="price_total"
                                                       string="Tax incl."
                                                       invisible="tax_calculation_rounding_method == 'round_globally'"
                                                       optional="hide"/>
                                            </group>
                                        </sheet>
                                    </form>
                                </field>
                                <group col="12" class="oe_invoice_lines_tab">
                                    <group colspan="8">
                                        <field name="narration" placeholder="Terms and Conditions" colspan="2" nolabel="1"/>
                                    </group>
                                    <!-- Totals (only invoices / receipts) -->
                                    <group colspan="4">
                                        <group class="oe_subtotal_footer"
                                            invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt') or payment_state == 'invoicing_legacy'">

                                            <field name="tax_totals" widget="account-tax-totals-field" nolabel="1" colspan="2"
                                                   readonly="state != 'draft' or (move_type not in ('in_invoice', 'in_refund', 'in_receipt') and not quick_edit_mode)"/>

                                            <field name="invoice_payments_widget" colspan="2" nolabel="1" widget="payment"/>
                                            <field name="amount_residual" class="oe_subtotal_footer_separator" invisible="state == 'draft'"/>
                                        </group>
                                        <field name="invoice_outstanding_credits_debits_widget"
                                            class="oe_invoice_outstanding_credits_debits"
                                            colspan="2" nolabel="1" widget="payment"
                                            invisible="state != 'posted'"/>
                                    </group>
                                </group>
                            </page>
                            <page id="aml_tab" string="Journal Items" groups="account.group_account_readonly" name="aml_tab">
                                <field name="line_ids"
                                       mode="tree,kanban"
                                       context="{
                                           'default_move_type': context.get('default_move_type'),
                                           'line_ids': line_ids,
                                           'journal_id': journal_id,
                                           'default_partner_id': commercial_partner_id,
                                           'default_currency_id': currency_id or company_currency_id,
                                           'kanban_view_ref': 'account.account_move_line_view_kanban_mobile',
                                       }"
                                       invisible="payment_state == 'invoicing_legacy' and move_type != 'entry'"
                                       readonly="state != 'draft'">
                                    <tree editable="bottom" string="Journal Items" decoration-muted="display_type in ('line_section', 'line_note')" default_order="sequence, id">
                                        <!-- Displayed fields -->
                                        <field name="account_id"
                                               invisible="display_type in ('line_section', 'line_note')"
                                               required="display_type not in ('line_section', 'line_note')"
                                               domain="[('company_id', 'parent_of', parent.company_id), ('deprecated', '=', False)]" />
                                        <field name="partner_id"
                                               optional="show"
                                               domain="['|', ('parent_id', '=', False), ('is_company', '=', True)]"
                                               column_invisible="parent.move_type != 'entry'"/>
                                        <field name="name" widget="section_and_note_text" optional="show"/>
                                        <field name="analytic_distribution" widget="analytic_distribution"
                                               groups="analytic.group_analytic_accounting"
                                               optional="show"
                                               options="{'account_field': 'account_id'}"
                                               business_domain_compute="parent.move_type in ['out_invoice', 'out_refund', 'out_receipt'] and 'invoice' or parent.move_type in ['in_invoice', 'in_refund', 'in_receipt'] and 'bill' or 'general'"/>
                                        <field name="date_maturity"
                                               optional="hide"
                                               invisible="display_type in ('line_section', 'line_note')"
                                               column_invisible="context.get('view_no_maturity')"/>
                                        <field name="amount_currency"
                                               groups="base.group_multi_currency"
                                               optional="hide"/>
                                        <field name="currency_id" options="{'no_create': True}"
                                               optional="hide" groups="base.group_multi_currency"
                                               column_invisible="parent.move_type != 'entry'"/>
                                        <field name="tax_ids" widget="autosave_many2many_tags"
                                               optional="hide"
                                               domain="[('type_tax_use', '=?', parent.invoice_filter_type_domain)]"
                                               context="{'append_type_to_tax_name': not parent.invoice_filter_type_domain, 'active_test': True}"
                                               options="{'no_create': True}"
                                               force_save="1"
                                               readonly="display_type in ('line_section', 'line_note') or tax_line_id or (parent.move_type in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt') and account_type in ('asset_receivable', 'liability_payable'))"/>
                                        <field name="debit"
                                               sum="Total Debit"
                                               invisible="display_type in ('line_section', 'line_note')"
                                               readonly="parent.move_type in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt') and display_type in ('line_section', 'line_note', 'product')"/>
                                        <field name="credit"
                                               sum="Total Credit"
                                               invisible="display_type in ('line_section', 'line_note')"
                                               readonly="parent.move_type in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt') and display_type in ('line_section', 'line_note', 'product')"/>
                                        <field name="balance" column_invisible="True"/>
                                        <field name="discount_date"
                                               string="Discount Date"
                                               optional="hide"
                                        />
                                        <field name="discount_amount_currency"
                                               string="Discount Amount"
                                               optional="hide"
                                        />

                                        <field name="tax_tag_ids"
                                               widget="many2many_tags"
                                               string="Tax Grids"
                                               optional="show"
                                               options="{'no_create': True}"
                                               domain="[
                                                    ('applicability', '=', 'taxes'),
                                                    '|', ('country_id', '=', parent.tax_country_id),
                                                    ('country_id', '=', False),
                                                ]"/>

                                        <field name="tax_tag_invert" readonly="1" optional="hide" groups="base.group_no_one"/>

                                        <!-- Buttons -->
                                        <button name="action_automatic_entry"
                                                type="object"
                                                icon="fa-calendar"
                                                string="Cut-Off"
                                                aria-label="Change Period"
                                                class="float-end"
                                                column_invisible="parent.move_type == 'entry' or parent.state != 'posted'"
                                                invisible="account_internal_group not in ('income', 'expense')"
                                                context="{'default_action': 'change_period'}"/>

                                        <!-- Others fields -->
                                        <field name="tax_line_id" column_invisible="True"/>
                                        <field name="company_currency_id" column_invisible="True"/>
                                        <field name="display_type" force_save="1" column_invisible="True"/>
                                        <field name="company_id" column_invisible="True"/>
                                        <field name="sequence" column_invisible="True"/>
                                        <field name="id" column_invisible="True"/>
                                        <field name="account_internal_group" column_invisible="True"/>
                                        <field name="account_type" column_invisible="True"/>
                                    </tree>
                                    <!-- Form view to cover mobile use -->
                                    <form>
                                      <group>
                                        <field name="account_id" domain="[('company_id', 'parent_of', parent.company_id), ('deprecated', '=', False)]"/>
                                        <field name="partner_id" domain="['|', ('parent_id', '=', False), ('is_company', '=', True)]"/>
                                        <field name="name"/>
                                        <field name="analytic_distribution" widget="analytic_distribution" groups="analytic.group_analytic_accounting"/>
                                        <field name="amount_currency" groups="base.group_multi_currency"/>
                                        <field name="company_currency_id" invisible="1"/>
                                        <field name="company_id" invisible="1"/>
                                        <field name="currency_id" options="{'no_create': True}" groups="base.group_multi_currency"/>
                                        <field name="debit" sum="Total Debit"/>
                                        <field name="credit" sum="Total Credit"/>
                                        <field name="balance" invisible="1"/>
                                        <field name="tax_ids" string="Taxes Applied" widget="autosave_many2many_tags" options="{'no_create': True}"/>
                                        <field name="date_maturity" required="0" invisible="context.get('view_no_maturity', False)"/>
                                      </group>
                                    </form>
                                </field>
                                <div class="alert alert-info text-center mb-0" role="alert" invisible="payment_state != 'invoicing_legacy' or move_type == 'entry'">
                                    <span>This entry has been generated through the Invoicing app, before installing Accounting. Its balance has been imported separately.</span>
                                </div>
                            </page>
                            <page id="other_tab" string="Other Info" name="other_info"
                                  invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund')">
                                <group id="other_tab_group">
                                    <group string="Invoice"
                                           name="sale_info_group"
                                           invisible="move_type not in ('out_invoice', 'out_refund')">
                                        <label for="ref" string="Customer Reference" />
                                        <field name="ref" nolabel="1"/>
                                        <field name="user_id" invisible="1" force_save="1"/>
                                        <field name="invoice_user_id" domain="[('share', '=', False)]" widget="many2one_avatar_user"/>
                                        <field name="invoice_origin" string="Source Document" force_save="1" invisible="1"/>
                                        <field name="partner_bank_id"
                                               context="{'default_partner_id': bank_partner_id, 'display_account_trust': True}"
                                               domain="[('partner_id', '=', bank_partner_id)]"
                                               readonly="state != 'draft'"/>
                                        <field name="qr_code_method"
                                               invisible="not display_qr_code"/>
                                        <field name="delivery_date" readonly="state != 'draft'"/>
                                    </group>
                                    <group string="Accounting"
                                           name="accounting_info_group"
                                           invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund')">
                                        <field name="company_id" groups="base.group_multi_company"/>
                                        <field name="invoice_incoterm_id"/>
                                        <field name="incoterm_location"/>
                                        <field name="fiscal_position_id" readonly="state in ['cancel', 'posted']"/>
                                        <field name="invoice_cash_rounding_id" groups="account.group_cash_rounding" readonly="state != 'draft'"/>
                                        <field name="invoice_source_email"
                                               widget="email"
                                               invisible="move_type not in ('in_invoice', 'in_refund') or not invoice_source_email"/>
                                        <field name="auto_post"
                                               readonly="state != 'draft'"/>
                                        <field name="auto_post_until"
                                               invisible="auto_post in ('no', 'at_date')"
                                               readonly="state != 'draft'"/>
                                        <field name="to_check"/>
                                    </group>
                                </group>
                            </page>
                            <page id="other_tab_entry" string="Other Info" name="other_info"
                                  invisible="move_type != 'entry'">
                                <group id="other_tab_entry_group">
                                    <group name="misc_group">
                                        <field name="auto_post"
                                               invisible="move_type != 'entry'"
                                               readonly="state != 'draft'"/>
                                        <field name="reversed_entry_id"
                                               invisible="move_type != 'entry' or not reversed_entry_id"/>
                                        <field name="auto_post_until"
                                               invisible="auto_post in ('no', 'at_date')"
                                               readonly="state != 'draft'"/>
                                        <field name="to_check"
                                               invisible="move_type != 'entry'" />
                                    </group>
                                    <group>
                                        <field name="fiscal_position_id" readonly="state in ['cancel', 'posted']"/>
                                        <field name="company_id" groups="base.group_multi_company" required="1"/>
                                    </group>
                                </group>
                                <!-- Internal note -->
                                <field name="narration" placeholder="Add an internal note..." nolabel="1" height="50"/>
                            </page>
                        </notebook>
                    </sheet>
                    <!-- Attachment preview -->
                    <div class="o_attachment_preview"
                         invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund') or state != 'draft'" />
                    <!-- Chatter -->
                    <div class="oe_chatter">
                        <field name="message_follower_ids" groups="base.group_user"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
		<!-- Installment Tree View -->
        <record model="ir.ui.view" id="view_grant_installment_tree">
            <field name="name">account.move</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <tree string="Installments">
                    <field name="name" string="Code"/>
                    <field name="invoice_date_due"/>
                    <field name="analytic_account_id" string="Fund" />
                    <field name="amount_total_in_currency_signed" string="Amount" widget='monetary' options="{'currency_field': 'currency_id'}" groups="base.group_multi_currency"  optional="show"/>
					<field name="currency_id" invisible="1"/>
					<field name="activity_ids" widget="list_activity"/>
                    <field name="state" 
						widget="badge"
						decoration-success="state in ('posted')"
						/>
					<field name="payment_state"
					   string="Payment State"
					   widget="badge"
					   decoration-danger="payment_state == 'not_paid'"
					   decoration-warning="payment_state in ('partial', 'in_payment')"
					   decoration-success="payment_state in ('paid', 'reversed')"
					   invisible="payment_state in ('invoicing_legacy')"
					   optional="show"/>
                </tree>
            </field>
        </record>
	<record model="ir.actions.act_window" id="action_grant_installmenttogrant">
        <field name="name">Installments</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,form</field>
        <field name="domain">['&amp;',('analytic_account_id','=',[analytic_account_id]), ('installment','=',True)]</field>
		<field name="context">{'default_move_type': move_type, 'default_installment':True, 'default_narration':''}</field>
		<field name="view_ids"
		   eval="[(5, 0, 0),
				  (0, 0, {'view_mode': 'tree', 'view_id': ref('view_grant_installment_tree')}),
				  (0, 0, {'view_mode': 'form', 'view_id': ref('view_grant_installment_form')})]"/>
    </record>
    <!-- Fund Form View -->
	<record id="view_grant_fund_form" model="ir.ui.view">
            <field name="name">grant.fund.form</field>
            <field name="model">grant.fund</field>
            <field name="arch" type="xml">
                <form string="Fund" delete="0">
                    <field name="company_id" invisible="1"/>
                    <header>
                        <button name="do_open" string="Start implementation" type="object" invisible="state not in ['draft']" groups="base.group_user" class="oe_highlight"/>
						<!-- <button name="do_cancel" string="Cancel" type="object" states="open" groups="base.group_user"/> --> 
						<button name="do_done" string="Implementation over" type="object" invisible="state not in ['open']" groups="base.group_user" class="oe_highlight"/>
						<button name="do_close" string="Close" type="object" invisible="state not in ['done']" groups="base.group_user" class="oe_highlight"/>
						<button name="do_open" string="Reopen" type="object" invisible="state not in ['done']" groups="base.group_user"/>
						<field name="state" widget="statusbar" statusbar_visible="open,done,close" statusbar_colors='{"pending":"blue"}' />
                    </header>
                <sheet string="Fund">
                    <div class="oe_button_box" name="button_box" groups="base.group_user">
                        <button class="oe_inline oe_stat_button" name="%(action_grant_partnertofund)d" type="action" icon="fa-users" context="{'default_project_id': project_id,'project_id': project_id,'search_default_active':1}" >
                            <field string="Partners" name="partner_count" widget="statinfo"/>
                        </button>
                        <button class="oe_inline oe_stat_button" name="%(action_grant_installmenttogrant)d" type="action" icon="fa-dollar"  invisible="direction == 'out'" context="{'default_analytic_account_id': analytic_account_id,'analytic_account_id':analytic_account_id,'search_default_active':1,'default_journal_id':outgoing_journal_id, 'default_partner_id':donor_id,'move_type':'in_invoice','default_currency_id':fundcurrency_id}" >
                            <field string="Installments" name="installment_received" widget="statinfo"/>
                        </button>
						<button class="oe_inline oe_stat_button" name="%(action_grant_installmenttogrant)d" type="action" icon="fa-dollar" invisible="direction == 'in'"  context="{'default_analytic_account_id': analytic_account_id,'analytic_account_id':analytic_account_id,'search_default_active':1,'default_journal_id':incoming_journal_id, 'default_partner_id':donor_id,'move_type':'out_invoice','default_currency_id':fundcurrency_id}" >
                            <field string="Installments" name="installment_received" widget="statinfo"/>
                        </button>
                        <button class="oe_inline oe_stat_button" name="%(action_grant_requirementtogrant)d" type="action" icon="fa-file-text-o" context="{'default_fund_id': active_id}" >
                            <field string="Requirements" name="requirement_count" widget="statinfo"/>
                        </button>
                        <button class="oe_stat_button" type="action"
                            name="%(project.act_project_project_2_project_task_all)d" icon="fa-tasks">
                            <field string="Tasks In Progress" name="task_count" widget="statinfo" options="{'label_field': 'label_tasks'}"/>
                        </button>
                        <!-- <button name="action_view_all_rating" type="object" attrs="{'invisible': ['|', ('rating_active', '=', False), ('rating_percentage_satisfaction', '=', -1)]}" class="oe_stat_button oe_percent oe_read_only" icon="fa-smile-o" groups="project.group_project_rating">
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_value">
                                    <field name="rating_percentage_satisfaction" nolabel="1"/>
                                    %
                                </span>
                                <span class="o_stat_text">
                                    Customer Satisfaction
                                </span>
                            </div>
                        </button>        -->                     
                    </div>
                    <widget name="web_ribbon" title="Archived" bg_color="bg-danger" invisible="active == True"/>
					<field name="project_id" invisible="1" />
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Internal Code"/>
                        </h1>
                        <div name="options_active">
                            <div>
                                <label for="label_tasks" class="oe_inline" string="Name of the tasks:"/>
                                <field name="label_tasks" class="oe_inline oe_input_align"/>
								<field name="partner_id" invisible="1"/>
                            </div>
                        </div>
                    </div>
					<group>
                        <group>
                            <field name="active" invisible="1"/>
							<field name="incoming_journal_id" invisible="1"/>
							<field name="outgoing_journal_id" invisible="1"/>
                            <field name="direction" />
							<field name="company_id" groups="base.group_multi_company"/>
							<field name="donor_id" context="{'default_customer': 0, 'search_default_donor': 1, 'default_donor': 1}" domain="[('donor', '=', True)]" invisible="direction == 'in'" />
                            <field name="fundtype_id" options="{'no_open': True}"/>
							<field name="analytic_account_id" />
                            <field name="code_contract" />
                            <field name="commercial_partner_id" string="Applicant" invisible="direction == 'out'"/>
                            <field name="partner_id" string="Applicant contact" invisible="direction == 'out'"/>
                            <field name="user_id" string="Responsible" widget="many2one_avatar_user"
                                    readonly="state in ['close', 'cancelled']"
                                    context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'project.group_project_manager']}"/>
                        </group>
                        <group>    
                            <field name="date_start" string="Date" widget="daterange" options='{"end_date_field": "date", "always_range": "1"}' required="date_start or date" />
                            <field name="date" invisible="1" required="date_start"/>
                            <field name="amount_granted" widget="monetary" options="{'currency_field': 'fundcurrency_id'}"/>
                            <label for="fundcurrency_id" class="oe_edit_only"/> <div><field name="fundcurrency_id" class="oe_edit_only"/></div>
                        </group>
                    </group>
                    <notebook>
                        <page string="Content">
                            <group >
                                <field name="title" />
                                <field name="title_orig" />
                                <field name="description" />
                                <field name="tag_ids" widget="many2many_tags"/>
                            </group>
                        </page>
                        <page string="Proposal Data">
                            <group >
                                <field name="proposal_id" />
                                <field name="call_id" />
                                <field name="amount_requested" widget="monetary" options="{'currency_field': 'fundcurrency_id'}" string="Amount requested"/>

                            </group>
                        </page>
                        <page name="settings" string="Settings">
                            <group>
                                <group>
                                    <field name="analytic_account_id" domain="['|', ('company_id', '=?', company_id), ('company_id', '=', False)]" context="{'default_partner_id': partner_id, 'default_company_id': company_id} " groups="analytic.group_analytic_accounting"/>
                                    <field name="privacy_visibility" widget="radio"/>
                                    <span colspan="2" class="text-muted o_row ps-1" invisible="access_instruction_message == ''">
                                        <i class="fa fa-lightbulb-o"/>&amp;nbsp;<field class="d-inline" name="access_instruction_message" nolabel="1"/>
                                    </span>
                                    <span colspan="2" class="text-muted o_row ps-1" invisible="privacy_visibility_warning == ''">
                                        <i class="fa fa-warning"/>&amp;nbsp;<field class="d-inline" name="privacy_visibility_warning" nolabel="1"/>
                                    </span>
                                </group>
                                <group>
                                    <div name="alias_def" colspan="2" class="pb-2">
                                        <!-- Always display the whole alias in edit mode. It depends in read only -->
                                        <label for="alias_name" class="fw-bold o_form_label" string="Create tasks by sending an email to"/>
                                        <field name="alias_email" class="oe_read_only d-inline" widget="email" readonly="1" invisible="not alias_name" />
                                        <span class="oe_edit_only o_row">
                                            <field name="alias_name"/>@
                                            <field name="alias_domain_id" class="oe_inline" placeholder="e.g. domain.com"
                                                   options="{'no_create': True, 'no_open': True}"/>
                                        </span>
                                    </div>
                                    <!-- the alias contact must appear when the user start typing and it must disappear
                                        when the string is deleted. -->
                                    <field name="alias_contact" class="oe_inline" string="Accept Emails From"
                                           invisible="not alias_email"/>
                                </group>
                                <group name="extra_settings">
                                </group>
                            </group>
                            <group>
                                <group name="group_tasks_managment" string="Tasks Management" col="1" class="row mt16 o_settings_container" groups="project.group_project_task_dependencies,project.group_project_milestone,project.group_project_recurring_tasks">
                                    <div>
                                        <setting class="col-lg-12" id="task_dependencies_setting" help="Determine the order in which to perform tasks" groups="project.group_project_task_dependencies">
                                            <field name="allow_task_dependencies"/>
                                        </setting>
                                        <setting class="col-lg-12" id="project_milestone_setting" help="Track major progress points that must be reached to achieve success" groups="project.group_project_milestone">
                                            <field name="allow_milestones"/>
                                        </setting>
                                    </div>
                                </group>
                                <group name="group_time_managment" string="Time Management" invisible="1" col="1" class="row mt16 o_settings_container"/>
                                <group name="group_documents_analytics" string="Analytics" col="1" class="row mt16 o_settings_container" invisible="not allow_rating">
                                    <div>
                                        <field name="allow_rating" invisible="1"/>
                                        <setting class="col-lg-12" name="analytic_div" help="Get customer feedback and evaluate the performance of your employees" groups="project.group_project_rating">
                                            <field name="rating_active"/>
                                            <div class="mt16" invisible="not rating_active">
                                                <span class="text-muted o_row ps-1 pb-3">Send a rating request:</span>
                                                <field name="rating_status" widget="radio" class="o_row"/>
                                                <div  invisible="rating_status != 'periodic'"  required="rating_status == 'periodic'">
                                                    <label for="rating_status_period" string="Frequency"/>
                                                    <field name="rating_status_period"/>
                                                </div>
                                                <span colspan="2" class="text-muted o_row ps-1">
                                                    <i class="fa fa-lightbulb-o pe-2"/>
                                                    <span invisible="rating_status == 'periodic'">A rating request will be sent as soon as the task reaches a stage on which a Rating Email Template is defined.</span>
                                                    <span invisible="rating_status == 'stage'">Rating requests will be sent as long as the task remains in a stage on which a Rating Email Template is defined.</span>
                                                </span>
                                                <div class="content-group">
                                                    <div class="mt8">
                                                        <button name="%(project.open_task_type_form_domain)d" context="{'project_id':id}" icon="oi-arrow-right" type="action" string="Set a Rating Email Template on Stages" class="btn-link"/>
                                                    </div>
                                                </div>
                                            </div>
                                        </setting>
                                    </div>
                                </group>
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" options="{'post_refresh':True}" help="Follow this project to automatically track the events associated to tasks and issues of this project." groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>
	<!-- Proposal Search View-->
    <record model="ir.ui.view" id="view_grant_proposal_search">
        <field name="name">grant.proposal.search</field>
        <field name="model">grant.proposal</field>
        <field name="arch" type="xml">
            <search string="Proposal">
                <field name="name" string="Name"/>
                <field name="donor_id" string="Donor"/>
				<field name="call_id" string="Call"/>
				<field name="tag_ids" string="Tags"/>
                <filter name="open" string="Open" domain="[('state','in', ['draft', 'open'])]" help="Open calls" />
            </search>
        </field>
    </record>	
	<!-- Proposal Tree View -->
        <record model="ir.ui.view" id="view_grant_proposal_tree">
            <field name="name">grant.proposal.tree</field>
            <field name="model">grant.proposal</field>
            <field name="arch" type="xml">
                <tree string="Proposals">
                    <field name="applicant_id" string="Applicant"/>
                    <field name="name" />
                    <field name="call_id"/>
                    <field name="user_id" widget="many2one_avatar_user" />
					<field name="activity_ids" widget="list_activity"/>
                    <field name="state" widget="badge" decoration-danger="state in ['cancel', 'close']"
                           decoration-success="state in ['done']"/>
                </tree>
            </field>
        </record>
    <!-- Proposal Form View -->
        <record id="view_grant_proposal_form" model="ir.ui.view">
            <field name="name">grant.proposal.form</field>
            <field name="model">grant.proposal</field>
            <field name="arch" type="xml">
                <form string="Proposal">
                <header>
                    <button name="do_open" string="Submit" type="object" invisible="state not in ['draft']" groups="base.group_user" class="oe_highlight"/>
                    <button name="do_done" string="Proposal won" type="object" invisible="state not in ['open']" groups="base.group_user"/>
                    <button name="do_close" string="Proposal lost" type="object" invisible="state not in ['open']" groups="base.group_user"/>
                    <button name="do_cancel" string="Cancel proposal" type="object" invisible="state not in ['draft', 'open']" groups="base.group_user"/>
                    <button name="createfund" string="Create fund" invisible="state not in ['done']" type="object" groups="base.group_user" class="oe_highlight" context="{'default_fundtype_id': %(grant.fund_type_grant)d}"/>
                    <field name="state" widget="statusbar" statusbar_visible="open,done" statusbar_colors='{"pending":"blue"}' readonly="1"/>
                </header>
                <sheet string="Proposal">
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only" string="Short title"/>
                        <h1>
                            <field name="name" string="Short title"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="direction" /> 
                            <field name="call_id" /> 
                            <field name="donor_id" context="{'default_customer': 0, 'search_default_donor': 1, 'default_donor': 1}" domain="[('donor', '=', True)]" />
                            <field name="applicant_id" />
                            <field name="applicant_contact_id" invisible="direction == 'out'"/>
                        </group>
                        <group>
                            <field name="code_proposal" />
                            <field name="date_submitted" invisible="state not in ['open', 'done']"/>
                            <field name="date_decision" />
                            <field name="user_id" string="Responsible"
                                    readonly="state in ['close', 'cancelled']"
                                    context="{'default_groups_ref': ['base.group_user', 'base.group_partner_manager', 'project.group_project_manager']}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Content">
                            <group >
                                <field name="title" />
                                <field name="description" />
                                <field name="date_start" />
                                <field name="date" />
                                <field name="tag_ids" widget="many2many_tags"/>
                            </group>
                        </page>
                        <page string="Financial data">
                            <group >
                                <field name="amount_requested" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="cofinannce" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="cofinannce_inkind" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                <field name="currency_id" class="oe_edit_only"/>
                            </group>
                        </page>
                        <page string="Partners">
                            <group >
                                <field name="partner_ids" widget="many2many_tags"/>
                            </group>
                        </page>
                        <page string="Notes">
                            <group >
                                <field name="comment" />
                            </group>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>
	    <record id="view_grant_proposal_kanban" model="ir.ui.view">
        <field name="name">grant.proposal.kanban</field>
        <field name="model">grant.proposal</field>
        <field name="priority" eval="100" />
        <field name="arch" type="xml">
            <kanban class="o_kanban_mobile" default_group_by="state">
                <field name="code_proposal" />
                <field name="name" />
                <field name="applicant_id" />
                <field name="user_id" />
                <field name="state" />

                <templates>
                    <t t-name="kanban-box">
                        <div
                            t-attf-class="oe_kanban_content oe_kanban_global_click"
                        >
                            <div class="o_kanban_record_top">
                                <div class="o_kanban_record_headings">
                                    <field name="name" />
                                    <field
                                        name="tag_ids"
                                        widget="many2many_tags"
                                        options="{'color_field': 'color'}"
                                    />
                                    <field name="code_proposal" />
                                    <small class="o_kanban_record_subtitle text-muted">
                                        <field name="applicant_id" />
                                    </small>
                                </div>
                                <div
                                    class="o_dropdown_kanban dropdown"
                                    t-if="!selection_mode"
                                    groups="base.group_user"
                                >
                                    <a
                                        role="button"
                                        class="dropdown-toggle o-no-caret btn"
                                        data-toggle="dropdown"
                                        data-display="static"
                                        href="#"
                                        aria-label="Dropdown menu"
                                        title="Dropdown menu"
                                    >
                                        <span class="fa fa-ellipsis-v" />
                                    </a>
                                    <div class="dropdown-menu" role="menu">
                                        <a
                                            t-if="widget.editable"
                                            role="menuitem"
                                            type="edit"
                                            class="dropdown-item"
                                        >Edit</a>
                                        <a
                                            t-if="widget.deletable"
                                            role="menuitem"
                                            type="delete"
                                            class="dropdown-item"
                                        >Delete</a>
                                        <div
                                            role="separator"
                                            class="dropdown-divider"
                                        />
                                    </div>
                                </div>
                            </div>
                            <div class="o_kanban_record_body" />
                            <div class="o_kanban_record_bottom">
                                <div class="oe_kanban_bottom_left">
                                    <field
                                        name="activity_ids"
                                        widget="kanban_activity"
                                        related="activity_state"
                                    />
                                </div>
                                <div class="oe_kanban_bottom_right">
                                    <field name="activity_state" invisible="1" />
                                    <img
                                        t-att-src="kanban_image('res.users', 'image_128', record.user_id.raw_value)"
                                        t-att-title="record.user_id.value"
                                        width="24"
                                        height="24"
                                        class="oe_kanban_avatar o_image_24_cover float-right"
                                        t-att-alt="record.user_id.value"
                                    />
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
	<!-- Call Search View-->
    <record model="ir.ui.view" id="view_grant_call_search">
        <field name="name">grant.call.search</field>
        <field name="model">grant.call</field>
        <field name="arch" type="xml">
            <search string="Call">
                <field name="name" string="Name"/>
                <field name="donor_id" string="Donor"/>
				<field name="tag_ids" string="Tags"/>
                <filter name="open" string="Open" domain="[('state','in', ['draft', 'open'])]" help="Open calls" />
            </search>
        </field>
    </record>	
    <!-- Calls Tree View -->
        <record model="ir.ui.view" id="view_grant_call_tree">
            <field name="name">grant.call.tree</field>
            <field name="model">grant.call</field>
            <field name="arch" type="xml">
                <tree string="Calls">
                    <field name="name" />
                    <field name="donor_id"/>
                    <field name="code"/>
                    <field name="date"/>
                    <field name="state" widget="badge" decoration-danger="state in ['cancel', 'close']"
                           decoration-success="state in ['open']"/>
                </tree>
            </field>
        </record>
    <!-- Calls Form View -->    
        <record id="view_grant_call_form" model="ir.ui.view">
            <field name="name">grant.call.form</field>
            <field name="model">grant.call</field>
            <field name="arch" type="xml">
                <form string="Call">
                <header>
                    <button name="do_open" string="Open" type="object" invisible="state not in ['draft', 'close', 'cancel']" groups="base.group_user" />
                    <button name="do_cancel" string="Cancel call" type="object" invisible="state not in ['draft', 'open']" groups="base.group_user"/>
                    <button name="%(grant.action_grant_createproposal)d" string="Create proposal" invisible="state not in ['draft', 'open', 'close']" type="action" groups="base.group_user" class="oe_highlight"  context="{'default_call_id': active_id}"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,open, close" statusbar_colors='{"pending":"blue"}' readonly="1"/>
                </header>
                <sheet string="Call">
                    <div class="oe_button_box" name="button_box" groups="base.group_user">
						<button class="oe_inline oe_stat_button" name="%(action_grant_proposaltocall)d" type="action" icon="fa-envelope" context="{'default_call_id': active_id}" >
                            <field string="Proposals" name="proposal_count" widget="statinfo"/>
                        </button>
					
					</div>
					<div class="oe_title">
                        <label for="name" class="oe_edit_only" string="Name"/>
                        <h1>
                            <field name="name" string="Name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="direction" />
							<field name="donor_id" context="{'default_customer': 0, 'search_default_donor': 1, 'default_donor': 1}" domain="[('donor', '=', True)]" /> 
                            <field name="code" />
                        </group>
                        <group>
                            <field name="date" />
                            <field name="date_decision" />
                        </group>
                    </group>
                    <group>
                        <field name="description" /> 
                        <field name="tag_ids" widget="many2many_tags" />
                        <field name="currency_id" class="oe_edit_only" />
                        <field name="min_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                        <field name="max_amount" widget="monetary" options="{'currency_field': 'currency_id'}"/>
                        <field name="url" widget="url"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>
    <!-- Requirement Tree View -->
        <record model="ir.ui.view" id="view_grant_requirement_tree">
            <field name="name">grant.requirement.tree</field>
            <field name="model">grant.requirement</field>
            <field name="arch" type="xml">
                <tree string="Requirements">
                    <field name="commercial_partner_id" invisible="context.get('hide_applicant') == True"/>
					<field name="fund_id"/>
                    <field name="name" />
                    <field name="type" />
                    <field name="date_due"/>
                    <field name="date_open"/>
                    <field name="date_close"/>
                    <field name="reportcontent_ids" widget="many2many_tags"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>
    <!-- Requirement Form View -->
        <record id="view_grant_requirement_form" model="ir.ui.view">
            <field name="name">grant.requirement.form</field>
            <field name="model">grant.requirement</field>
            <field name="arch" type="xml">
                <form string="Requirement">
                <header>
                    <button name="do_open" string="Due" type="object" invisible="state not in ['draft']" groups="base.group_user" class="oe_highlight"/>
                    <button name="do_done" string="Submit" type="object" invisible="state not in ['open', 'revise']" groups="base.group_user" class="oe_highlight"/>
                    <button name="do_close" string="Accept" type="object" invisible="state not in ['done']" groups="base.group_user" class="oe_highlight"/>
                    <button name="do_revise" string="Revise" type="object" invisible="state not in ['done']" groups="base.group_user" />
                    <!-- <button name="do_cancel" string="Cancel" type="object" states="draft" groups="base.group_user"/> -->
                    <field name="state" widget="statusbar" statusbar_visible="draft,open,done,close" statusbar_colors='{"pending":"blue"}' readonly="1"/>
                </header>
                <sheet string="Requirement">
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only" string="Name"/>
                        <h1>
                            <field name="name" string="Name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="fund_id" /> 
                            <field name="type" widget="radio"/>
                            <field name="date_due" />
                            <field name="date_submit" invisible="state not in ['done', 'revise', 'close']" />
                        </group>
                        <group>
                            <field name="date_open" invisible="['|', ('type','=',False), ('type','=','contract')]" />
                            <field name="date_close" invisible="['|', ('type','=',False), ('type','=','contract')]" />
                            <field name="reportcontent_ids" widget="many2many_tags" invisible="['|', ('type','=',False), ('type','=','contract')]" />
                        </group>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
                </form>
            </field>
        </record>    
    <!-- Requirement Search View-->
    <record model="ir.ui.view" id="view_grant_requirement_search">
        <field name="name">grant.requirement.search</field>
        <field name="model">grant.requirement</field>
        <field name="arch" type="xml">
            <search string="Requirement">
                <field name="name" string="Name"/>
                <field name="fund_id" string="Fund"/>
                <field name="type" string="Type"/>
                <filter name="due" string="Due" domain="[('state','=', 'draft')]" help="Requirements to submit" />
                <filter name="overdue" string="Overdue" domain="[('date_due','&lt;', ((context_today())).strftime('%%Y-%%m-%%d 00:00:00')), ('state','=','draft')]" help="Requirements overdue" />
            </search>
        </field>
    </record>
    <!-- Donor flag to Partner Form-->
    <record id="view_grant_donor_partnermod_form" model="ir.ui.view">
            <field name="name">Donor flag on partner form</field>
            <field name="model">res.partner</field>
            <field name="inherit_id" ref="base.view_partner_form"/>
            <field name="arch" type="xml">
                <field name="website" position="after" >
                    <field name="donor" />
                </field>
            </field>
    </record> 
    <!-- Donor filter to Partner Tree-->
    <record id="view_grant_donor_partnermod_search" model="ir.ui.view">
            <field name="name">Donor filter on partner tree</field>
            <field name="model">res.partner</field>
            <field name="priority">2</field>
            <field name="inherit_id" ref="account.res_partner_view_search"/>
            <field name="arch" type="xml">
                <filter name="supplier" position="after" >
                    <filter string="Donors" name="donor" domain="[('donor','=',1)]" help="Donor Partners"/>
                </filter>
            </field>
    </record> 
    <record model="ir.actions.act_window" id="action_grant_fund">
        <field name="name">Funds</field>
        <field name="res_model">grant.fund</field>
        <field name="view_mode">tree,form</field>
        <field name="context" eval="{'search_default_open':1, 'default_direction':'out'}" />
        <field name="domain">[('direction','=','out')]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_call">
        <field name="name">Calls for proposals</field>
        <field name="res_model">grant.call</field>
        <field name="view_mode">tree,form</field>
        <field name="context" eval="{'search_default_open':1,'default_direction':'out'}" />
        <field name="domain">[('direction','=','out')]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_installment">
        <field name="name">Installments</field>
        <field name="res_model">account.move</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('view_grant_installment_tree')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('view_grant_installment_form')})]"/>
		<field name="domain">[('installment','=',True),('move_type','=','out_invoice')]</field>
		<field name="context" eval="{'default_journal_id':ref('grant_account_journal_in'), 'default_move_type':'out_invoice', 'default_narration':'', 'default_installment':True,}" />
    </record>
    <record model="ir.actions.act_window" id="action_grant_requirement">
        <field name="name">Requirements</field>
        <field name="res_model">grant.requirement</field>
        <field name="view_mode">tree,form</field>
		<field name="domain">[('fund_id.direction','=','out')]</field>
        <field name="context" eval="{'hide_applicant':True}" /> 
    </record>
    <record model="ir.actions.act_window" id="action_grant_requirement_incoming">
        <field name="name">Requirements</field>
        <field name="res_model">grant.requirement</field>
        <field name="view_mode">tree,form</field>
		<field name="domain">[('fund_id.direction','=','in')]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_proposal">
        <field name="name">Proposals</field>
        <field name="res_model">grant.proposal</field>
        <field name="view_mode">tree,form</field>
        <field name="context" eval="{'search_default_open':1, 'default_direction':'out'}" /> 
        <field name="domain">[('direction','=','out')]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_proposal_incoming">
        <field name="name">Incoming Proposals</field>
        <field name="res_model">grant.proposal</field>
        <field name="view_mode">kanban,tree,form</field>
        <field name="context" eval="{'search_default_open':1, 'default_direction':'in'}" />
        <field name="domain">[('direction','=','in')]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_call_incoming">
        <field name="name">Incoming Calls</field>
        <field name="res_model">grant.call</field>
        <field name="view_mode">tree,form</field>
        <field name="context" eval="{'search_default_open':1, 'default_direction':'in'}" />
        <field name="domain">[('direction','=','in')]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_fund_incoming">
        <field name="name">Supported projects</field>
        <field name="res_model">grant.fund</field>
        <field name="view_mode">tree,form</field>
        <field name="context" eval="{'search_default_open':1, 'default_direction':'in'}" />
        <field name="domain">[('direction','=','in')]</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_donor">
        <field name="name">Donors</field>
        <field name="res_model">res.partner</field>
        <field name="view_mode">tree,form</field>
        <field name="context" eval="{'search_default_donor':1}" /> 
    </record>
    <record model="ir.actions.act_window" id="action_grant_fundtype">
        <field name="name">Fund types</field>
        <field name="res_model">grant.fundtype</field>
        <field name="view_mode">tree,form</field>
    </record>
    <record model="ir.actions.act_window" id="action_grant_reportcontent">
        <field name="name">Report content</field>
        <field name="res_model">grant.reportcontent</field>
        <field name="view_mode">tree,form</field>
    </record>
 
    <menuitem name="Grants" id="menu_grant" groups="grant.group_grant_user" web_icon="grant,static/description/icon.png" />
    <menuitem name="Funds" parent="menu_grant" id="menu_grant_fund" />
    <menuitem name="Funds" parent="menu_grant_fund" id="menu_grant_fund_fund" action="action_grant_fund" />
    <menuitem name="Installments" parent="menu_grant_fund" id="menu_grant_installments" action="action_grant_installment" />
    <menuitem name="Requirements" parent="menu_grant_fund" id="menu_grant_requirements" action="action_grant_requirement" />
    <menuitem name="Proposals" parent="menu_grant" id="menu_grant_proposal"  />
    <menuitem name="Proposals" parent="menu_grant_proposal" id="menu_grant_proposal_proposal" action="action_grant_proposal" />
    <menuitem name="Incoming Proposals" parent="menu_grant" id="menu_grant_proposal_incoming"  />
    <menuitem name="Calls" parent="menu_grant_proposal_incoming" id="menu_grant_calls_incoming" action="action_grant_call_incoming" />
	<menuitem name="Proposals" parent="menu_grant_proposal_incoming" id="menu_grant_proposal_incoming_proposal" action="action_grant_proposal_incoming" />
    <menuitem name="Supported projects" parent="menu_grant_proposal_incoming" id="menu_grant_proposal_incoming_fund" action="action_grant_fund_incoming" />
    <menuitem name="Requirements" parent="menu_grant_proposal_incoming" id="menu_grant_proposal_incoming_requirement" action="action_grant_requirement_incoming" />
    <menuitem name="Calls" parent="menu_grant_proposal" id="menu_grant_calls" action="action_grant_call" />    
    <menuitem name="Donors" parent="menu_grant_proposal" groups="group_grant_manager" id="menu_grant_donor"  action="action_grant_donor" sequence="100"/>
    <menuitem name="Configuration" groups="grant.group_grant_manager" parent="menu_grant" id="menu_grant_config" />
    <menuitem name="Fund types" parent="menu_grant_config" id="menu_grant_config_fundtype" action="action_grant_fundtype" />
    <menuitem name="Report content" parent="menu_grant_config" id="menu_grant_config_reportcontent" action="action_grant_reportcontent" />
   </data>
</openerp>
